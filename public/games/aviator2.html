<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Jeeto92 Aviator - Professional</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/games.css">
    <style>
        /* Original aviator styles */
        .game-container {
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: calc(100vh - 8vh); /* Adjusted for our nav */
        }

        .header {
            background: linear-gradient(135deg, rgba(20,20,20,0.95), rgba(40,40,40,0.95));
            backdrop-filter: blur(20px);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            z-index: 100;
            flex-shrink: 0;
        }

        /* Rest of your original styles */

        /* Add our website's theme compatibility */
        .main-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .game-wrapper {
            margin-top: 8vh;
            height: calc(100vh - 8vh);
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Add our website's navigation -->
    <nav class="main-nav">
        <div class="logo">Jeeto92</div>
        <div class="balance">Balance: ₹<span id="userBalance">0.00</span></div>
        <div class="nav-links">
            <a href="/dashboard.html">Games</a>
            <a href="/deposit.html">Deposit</a>
            <a href="/withdraw.html">Withdraw</a>
            <a href="/profile.html">Profile</a>
            <button id="logoutBtn">Logout</button>
        </div>
    </nav>

    <div class="game-wrapper">
        <!-- Your original aviator game content -->
        <div class="game-container">
            <div class="header">
                <div class="logo">
                    <div class="logo-icon"></div>
                    <div class="logo-text">AVIATOR</div>
                </div>
                <div class="balance" id="gameBalance">Balance: ₹<span id="balanceDisplay">0.00</span></div>
            </div>

            <!-- Rest of your original game HTML -->

        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/api.js"></script>
    <script>
        // Initialize socket connection
        const socket = io();
        let currentBet = 0;
        let userBalance = 0;
        let gameState = 'waiting';
        let gameStartTime = 0;
        let currentMultiplier = 1.00;
        let crashPoint = 0;
        let flightPath = [];
        let animationId = null;
        const maxMultiplier = 5.00;

        // Connect to game-specific socket room
        socket.emit('join-game', 'aviator');

        // Listen for game events
        socket.on('bet-placed', (data) => {
            // Handle other players' bets
            showNotification(`${data.username} bet ₹${data.amount}`, 'info');
        });

        socket.on('game-crash', (data) => {
            // Handle synchronized crash point
            crashPoint = data.crashPoint;
        });

        // Modified balance update function to use our API
        async function updateBalance() {
            try {
                userBalance = await API.getBalance();
                document.getElementById('balanceDisplay').textContent = userBalance.toLocaleString();
                document.getElementById('userBalance').textContent = userBalance.toLocaleString();
            } catch (error) {
                console.error('Failed to update balance:', error);
                showNotification('Failed to update balance', 'error');
            }
        }

        // Modified bet placement function
        async function placeBet() {
            const betAmount = parseFloat(document.getElementById('betInput').value);
            
            if (isNaN(betAmount) || betAmount <= 0) {
                showNotification('Please enter a valid bet amount', 'error');
                return;
            }

            if (betAmount > userBalance) {
                showNotification('Insufficient balance', 'error');
                return;
            }

            try {
                // Record the bet
                await API.recordTransaction('bet', betAmount, 'aviator');
                currentBet = betAmount;
                
                // Update UI
                await updateBalance();
                socket.emit('place-bet', { amount: betAmount, game: 'aviator' });
                
                // Start the game
                startFlight();
            } catch (error) {
                console.error('Failed to place bet:', error);
                showNotification('Failed to place bet', 'error');
            }
        }

        // Modified cashout function
        async function cashOut() {
            if (gameState !== 'flying' || currentBet <= 0) return;

            const winAmount = currentBet * currentMultiplier;
            
            try {
                // Record the win
                await API.recordTransaction('win', winAmount, 'aviator');
                currentBet = 0;
                
                // Update UI
                await updateBalance();
                showNotification(`Won ₹${winAmount.toFixed(2)}!`, 'success');
                
                // Update game state
                document.getElementById('actionBtn').textContent = 'Watching Flight';
                document.getElementById('actionBtn').className = 'action-btn disabled-btn';
                document.getElementById('actionBtn').onclick = null;
            } catch (error) {
                console.error('Failed to process win:', error);
                showNotification('Failed to process win', 'error');
            }
        }

        // Your original game functions here
        // ... (rest of your original JavaScript)

        // Initialize
        window.addEventListener('load', async () => {
            await updateBalance();
            startNewRound();
        });
    </script>
</body>
</html>
